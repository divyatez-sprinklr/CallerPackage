<!DOCTYPE html>
<html lang="en">
â€‹
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <title>Test JSSIP</title>
    <script type="text/javascript" src="https://jssip.net/download/releases/jssip-3.2.11.js"></script>
</head>
<body>
    <label for="username">Username</label>
    <input type="text" name="username" id="username" value="1000">
    <label for="password">Password</label>
    <input type="text" name="password" id="password" value="1000_client">
    <label for="domain">Domain</label>
    <input type="text" name="domain" id="domain" value="18.212.171.223">
    <button id="connect_button" >Connect</button>
    <br>
    <br>
    <audio id="remoteView" autoplay controls></audio>
    <button id="ans_button" onclick="answer()">Answer</button>
    <button id="decline_button" onclick="decline()">End</button>
    <script type="text/javascript">
        document.getElementById('connect_button').addEventListener('click',()=>{
            connect();
        });
        var remoteView = document.getElementById("remoteView");
        var call, ua;
        function answer() {
            if (call) {
                call.answer({
                    "extraHeaders": ["X-Foo: foo", "X-Bar: bar"],
                    "mediaConstraints": { "audio": true, "video": false },
                    "pcConfig": { rtcpMuxPolicy: "negotiate" },
                    "rtcOfferConstraints": {
                        offerToReceiveAudio: 1,
                        offerToReceiveVideo: 0
                    }
                });
            }
        }
        function decline() {
            if (call) {
                call.terminate();
            }
        }
        function decline() {
            if (call) {
                call.terminate();
            }
        }
        function connect() {
            let sip = "1000";
            let password = "1000_client";
            let server_address = "18.212.171.223";
           // wss://18.212.171.223:7443/ws
            
            var configuration = {
                sockets: [
                    new JsSIP.WebSocketInterface("wss://" + server_address + ":7443/ws")
                ],
                uri: "sip:" + sip + "@" + server_address,
                authorization_user: sip,
                password: password,
                registrar_server: "sip:" + server_address,
                session_timers: false,
                connection_recovery_max_interval: 60,
                connection_recovery_min_interval: 4

            };
            ua = new JsSIP.UA(configuration);
            ua.on("connected", function (e) {
                console.log("connected", e);
            });
            ua.on("newRTCSession", function (e) {
                console.log("newRTCSession", e);
                call = e.session;
                call.on("sdp", function (e) {
                    console.log("call sdp:", e);
                    var lbody = e.sdp.split("\n");
                    var tempbody;
                    for (var i = 0; i < lbody.length; i++) {
                        if (!lbody[i].indexOf("a=crypto:1")) {
                            continue;
                        }
                        if (!tempbody) {
                            tempbody = lbody[i];
                        } else {
                            tempbody += "\n" + lbody[i];
                        }
                    }
                    e.sdp = tempbody;
                });
                call.on("accepted", function (e) {
                    console.log("call accepted", e);
                });
                call.on("progress", function (e) {
                    console.log("call is in progress", e);
                    answer();
                });
                call.on("confirmed", function (e) {
                    console.log("call accepted/confirmed", e);
                });
                call.on("ended", function (e) {
                    console.log("Call ended: ", e);
                });
                call.on("failed", function (e) {
                    console.log("Call failed: ", e);
                });
                /*call.on("addstream", function (e) {
                    console.log("call addstream: ", e);
                    var remoteStream = e.stream;
                    remoteView = document.getElementById("remoteView");
                    remoteView = JsSIP.rtcninja.attachMediaStream(remoteView, remoteStream);
                });*/
                call.on("peerconnection", function (e) {
                    console.log("call peerconnection: ", e);
                    e.peerconnection.onaddstream = function (e) {
                        console.log("call peerconnection addstream:", e);
                        remoteView = document.getElementById("remoteView");
                        var remoteStream = e.stream;
                        remoteView.srcObject = remoteStream;
                    };
                });
            });
            ua.start();
        }
        //document.addEventListener("DOMContentLoaded", connect);
    </script>
</body>
</html>